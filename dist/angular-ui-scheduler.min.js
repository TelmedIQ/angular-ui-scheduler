angular.module("angular-ui-scheduler",["Timezones"]).constant("useTimezone",!1).constant("showUTCField",!1),angular.module("angular-ui-scheduler").filter("schDateStrFix",function(){return function(e){return e.replace(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}).*Z/,function(e,r,t,n,a,s,u){return t+"/"+n+"/"+r+" "+a+":"+s+":"+u+" UTC"})}}),angular.module("angular-ui-scheduler").filter("schZeroPad",function(){return function(e,r){var t=(Math.pow(10,r)+"").replace(/^1/,"")+(e+"").trim();return t.substr(t.length-r)}}),angular.module("angular-ui-scheduler").factory("GetRule",["$log",function(e){return function(r){var t,n=r.startDate,a=r.frequency,s=r.interval,u=r.occurrenceCount,l=r.endDate,c=r.month,o=r.monthDay,i=r.weekDays,h=r.setOccurrence,d={};if(angular.isDate(n))d.dtstart=n;else try{d.dtstart=new Date(n)}catch(y){e.error("Date conversion failed. Attempted to convert "+n+" to Date. "+y.message)}if(a&&"none"!==a){if(d.freq=RRule[a.toUpperCase()],d.interval=s,i&&"string"==typeof i&&(d.byweekday=RRule[i.toUpperCase()]),i&&angular.isArray(i))for(d.byweekday=[],t=0;t<i.length;t++)d.byweekday.push(RRule[i[t].toUpperCase()]);if(void 0!==h&&null!==h&&(d.bysetpos=h),c&&(d.bymonth=c),o&&(d.bymonthday=o),u)d.count=u;else if(l)if(angular.isDate(l))d.until=l;else try{d.until=new Date(l)}catch(y){e.error("Date conversion failed. Attempted to convert "+l+" to Date. "+y.message)}}else d.freq=RRule.DAILY,d.interval=1,d.count=1;return new RRule(d)}}]),angular.module("angular-ui-scheduler").factory("InRange",function(){return function(e,r,t,n){var a=new RegExp("\\d{1,"+n+"}");return a.test(e)?r>e||e>t?!1:!0:!1}}),angular.module("angular-ui-scheduler").factory("SetRule",["useTimezone","$log","$timezones","$filter",function(e,r,t,n){return function(t,a){function s(e,r){var t=_.find(e,function(e){var t=e.split(/=/)[0].toUpperCase();return t===r});return t?t.split(/=/)[1].toUpperCase():null}function u(e){var r=e.toLowerCase().split(/,/),t=_.find(a.weekdays,function(e){var t=angular.isArray(e.value)?e.value:[e.value],n=_.difference(t,r),a=_.difference(r,t);return 0===n.length&&0===a.length});return t}function l(r,t){var l,c,o,i,y,m,p,v=r.split(/=/)[0].toUpperCase(),f=r.split(/=/)[1];if("NAME"===v&&(a.schedulerName=f),"FREQ"===v&&(c=f.toLowerCase(),a.schedulerFrequency=_.find(a.frequencyOptions,function(e){return a.schedulerIntervalLabel=e.intervalLabel,e.value===c}),a.schedulerFrequency&&a.schedulerFrequency.name||(h="FREQ not found in list of valid options")),"INTERVAL"===v&&(parseInt(f,10)?(a.schedulerInterval=parseInt(f,10),a.schedulerShowInterval=!0):h="INTERVAL must contain an integer > 0"),"BYDAY"===v)if("WEEKLY"===s(t,"FREQ"))for(l=f.split(/,/),a.weekDays=[],o=0;o<l.length;o++)_.contains(["SU","MO","TU","WE","TH","FR","SA"],l[o])?(a.weekDays.push(l[o].toLowerCase()),a["weekDay"+l[o].toUpperCase()+"Class"]="active"):h="BYDAY contains unrecognized day value(s)";else"MONTHLY"===s(t,"FREQ")?(a.monthlyRepeatOption="other",a.monthlyWeekDay=u(f),a.monthlyWeekDay||(h="BYDAY contains unrecognized day value(s)")):(a.yearlyRepeatOption="other",a.yearlyWeekDay=u(f),a.yearlyWeekDay||(h="BYDAY contains unrecognized day value(s)"));"BYMONTHDAY"===v&&(parseInt(f,10)&&parseInt(f,10)>0&&parseInt(f,10)<32?(a.monthDay=parseInt(f,10),a.monhthlyRepeatOption="day"):h="BYMONTHDAY must contain an integer between 1 and 31"),"DTSTART"===v&&(d=!0,/\d{8}T\d{6}.*Z/.test(f)&&(f=f.replace(/(\d{4})(\d{2})(\d{2}T)(\d{2})(\d{2})(\d{2}.*$)/,function(e,r,t,n,a,s,u){return r+"-"+t+"-"+n+a+":"+s+":"+u.substr(0,2)+"Z"})),e?(i=new Date(f),y=n("schZeroPad")(i.getMonth()+1,2),m=n("schZeroPad")(i.getDate(),2),a.schedulerStartDt=y+"/"+m+"/"+i.getFullYear(),a.schedulerStartHour=n("schZeroPad")(i.getHours(),2),a.schedulerStartMinute=n("schZeroPad")(i.getMinutes(),2),a.schedulerStartSecond=n("schZeroPad")(i.getSeconds(),2),a.scheduleTimeChange()):(a.schedulerStartDt=f.replace(/T.*$/,"").replace(/(\d{4})-(\d{2})-(\d{2})/,function(e,r,t,n){return t+"/"+n+"/"+r}),p=f.replace(/^.*T/,""),a.schedulerStartHour=n("schZeroPad")(p.substr(0,2),2),a.schedulerStartMinute=n("schZeroPad")(p.substr(3,2),2),a.schedulerStartSecond=n("schZeroPad")(p.substr(6,2),2)),a.scheduleTimeChange()),"BYSETPOS"===v&&("YEARLY"===s(t,"FREQ")?(a.yearlRepeatOption="other",a.yearlyOccurrence=_.find(a.occurrences,function(e){return e.value===parseInt(f,10)}),a.yearlyOccurrence&&a.yearlyOccurrence.name||(h="BYSETPOS was not in the set of 1,2,3,4,-1")):(a.monthlyOccurrence=_.find(a.occurrences,function(e){return e.value===parseInt(f,10)}),a.monthlyOccurrence&&a.monthlyOccurrence.name||(h="BYSETPOS was not in the set of 1,2,3,4,-1"))),"COUNT"===v&&(parseInt(f,10)?(a.schedulerEnd=a.endOptions[1],a.schedulerOccurrenceCount=parseInt(f,10)):h="COUNT must be a valid integer > 0"),"UNTIL"===v&&(/\d{8}T\d{6}.*Z/.test(f)&&(f=f.replace(/(\d{4})(\d{2})(\d{2}T)(\d{2})(\d{2})(\d{2}.*$)/,function(e,r,t,n,a,s,u){return r+"-"+t+"-"+n+a+":"+s+":"+u.substr(0,2)+"Z"})),a.schedulerEnd=a.endOptions[2],e?(i=new Date(f),y=n("schZeroPad")(i.getMonth()+1,2),m=n("schZeroPad")(i.getDate(),2),a.schedulerEndDt=y+"/"+m+"/"+i.getFullYear()):a.schedulerEndDt=f.replace(/T.*$/,"").replace(/(\d{4})-(\d{2})-(\d{2})/,function(e,r,t,n){return t+"/"+n+"/"+r})),"BYMONTH"===v&&("YEARLY"===s(t,"FREQ")&&s(t,"BYDAY")?(a.yearlRepeatOption="other",a.yearlyOtherMonth=_.find(a.months,function(e){return e.value===parseInt(f,10)}),a.yearlyOtherMonth&&a.yearlyOtherMonth.name||(h="BYMONTH must be an integer between 1 and 12")):(a.yearlyOption="month",a.yearlyMonth=_.find(a.months,function(e){return e.value===parseInt(f,10)}),a.yearlyMonth&&a.yearlyMonth.name||(h="BYMONTH must be an integer between 1 and 12"))),"BYMONTHDAY"===v&&(parseInt(f,10)?a.yearlyMonthDay=parseInt(f,10):h="BYMONTHDAY must be an integer between 1 and 31")}function c(){"weekly"===a.schedulerFrequency.name&&0===a.weekDays.length&&(h="Frequency is weekly, but BYDAYS value is missing."),d||(h="Warning: start date was not provided")}var o,i,h="",d=!1;if(t)if(o=t.split(/;/),angular.isArray(o)){for(i=0;i<o.length&&(l(o[i],o),!h);i++);h||c()}else h="No rule entered. Provide a valid RRule string.";else h="No rule entered. Provide a valid RRule string.";return h&&r.error(h),h}}]),angular.module("angular-ui-scheduler").controller("angularUiSchedulerCtrl",["$scope","$filter","$log","$timezones","useTimezone","showUTCField","InRange","GetRule","SetRule",function(e,r,t,n,a,s,u,l,c){function o(e,t){var s=function(){this.scope=e,this.useTimezone=a,this.requireFutureStartTime=t,this.getOptions=function(){var r={};return r.startDate=this.scope.schedulerUTCTime,r.frequency=this.scope.schedulerFrequency.value,r.interval=this.scope.schedulerInterval,"after"===this.scope.schedulerEnd.value&&(r.occurrenceCount=this.scope.schedulerOccurrenceCount),"on"===this.scope.schedulerEnd.value&&(r.endDate=e.schedulerEndDt.replace(/(\d{2})\/(\d{2})\/(\d{4})/,function(e,r,t,n){return n+"-"+r+"-"+t})+"T"+this.scope.schedulerUTCTime.replace(/\d{2}\/\d{2}\/\d{4} /,"").replace(/ UTC/,"")+"Z"),"weekly"===this.scope.schedulerFrequency.value?r.weekDays=this.scope.weekDays:"yearly"===this.scope.schedulerFrequency.value?"month"===this.scope.yearlyRepeatOption?(r.month=this.scope.yearlyMonth.value,r.monthDay=this.scope.yearlyMonthDay):(r.setOccurrence=this.scope.yearlyOccurrence.value,r.weekDays=this.scope.yearlyWeekDay.value,r.month=this.scope.yearlyOtherMonth.value):"monthly"===this.scope.schedulerFrequency.value&&("day"===this.scope.monthlyRepeatOption?r.monthDay=this.scope.monthDay:(r.setOccurrence=this.scope.monthlyOccurrence.value,r.weekDays=this.scope.monthlyWeekDay.value)),r},this.clearErrors=function(){this.scope.scheduler_weekDays_error=!1,this.scope.scheduler_endDt_error=!1,this.scope.resetStartDate(),this.scope.scheduler_endDt_error=!1,this.scope.scheduler_interval_error=!1,this.scope.scheduler_occurrenceCount_error=!1,this.scope.scheduler_monthDay_error=!1,this.scope.scheduler_yearlyMonthDay_error=!1,this.scope.scheduler_form&&this.scope.scheduler_form.schedulerEndDt&&(this.scope.scheduler_form.schedulerEndDt.$setValidity("custom-error",!0),this.scope.scheduler_form.schedulerEndDt.$setPristine(),this.scope.scheduler_form.$setPristine())},this.setDetails=function(){var e=this.getRRule(),t=this.scope;e&&(t.rrule_nlp_description=e.toText(),t.dateChoice="local",t.occurrence_list=[],e.all(function(e,s){var u,l;return 10>s?(a?(l=n.align(e,t.schedulerTimeZone.name),u=r("schZeroPad")(l.getMonth()+1,2)+"/"+r("schZeroPad")(l.getDate(),2)+"/"+l.getFullYear()+" "+r("schZeroPad")(l.getHours(),2)+":"+r("schZeroPad")(l.getMinutes(),2)+":"+r("schZeroPad")(l.getSeconds(),2)+" "+l.getTimezoneAbbreviation()):u=r("date")(e,"MM/dd/yyyy HH:mm:ss Z"),t.occurrence_list.push({utc:r("schDateStrFix")(e.toISOString()),local:u}),!0):!1}),t.rrule_nlp_description=e.toText().replace(/^RRule error.*$/,"Natural language description not available"),t.rrule=e.toString())},this.isValid=function(){var t,a,s,l,c,o,i=!0;if(this.clearErrors(),"none"===this.scope.schedulerFrequency.value||u(this.scope.schedulerInterval,1,999,3)||(this.scope.scheduler_interval_error=!0,i=!1),"after"!==this.scope.schedulerEnd.value||u(this.scope.schedulerOccurrenceCount,1,999,3)||(this.scope.scheduler_occurrenceCount_error=!0,i=!1),"weekly"===this.scope.schedulerFrequency.value&&0===this.scope.weekDays.length&&(this.scope.scheduler_weekDays_error=!0,i=!1),"monthly"!==this.scope.schedulerFrequency.value||"day"!==this.scope.monthlyRepeatOption||u(this.scope.monthDay,1,31,99)||(this.scope.scheduler_monthDay_error=!0,i=!1),"yearly"!==this.scope.schedulerFrequency.value||"month"!==this.scope.yearlyRepeatOption||u(this.scope.yearlyMonthDay,1,31,99)||(this.scope.scheduler_yearlyMonthDay_error=!0,i=!1),u(e.schedulerStartHour,0,23,2)&&u(e.schedulerStartMinute,0,59,2)&&u(e.schedulerStartSecond,0,59,2)||(this.scope.scheduler_startTime_error=!0,i=!1),this.scope.scheduler_form.schedulerName.$valid||(this.scope.scheduler_form.schedulerName.$dirty=!0,$("#schedulerName").addClass("ng-dirty"),i=!1),"on"===this.scope.schedulerEnd.value&&(/^\d{2}\/\d{2}\/\d{4}$/.test(this.scope.schedulerEndDt)||(this.scope.scheduler_form.schedulerEndDt.$pristine=!1,this.scope.scheduler_form.schedulerEndDt.$dirty=!0,$("#schedulerEndDt").removeClass("ng-pristine").removeClass("ng-valid").removeClass("ng-valid-custom-error").addClass("ng-dirty").addClass("ng-invalid").addClass("ng-invalid-custom-error"),this.scope.scheduler_endDt_error=!0,i=!1)),this.scope.schedulerUTCTime)try{t=new Date(this.scope.schedulerUTCTime),isNaN(t)?(this.scope.startDateError("Invalid start time"),i=!1):(o=t.getTime(),a=new Date,this.useTimezone?(s=a.getFullYear()+"-"+r("schZeroPad")(a.getMonth()+1,2)+"-"+r("schZeroPad")(a.getDate(),2)+"T"+r("schZeroPad")(a.getHours(),2)+":"+r("schZeroPad")(a.getMinutes(),2)+":"+r("schZeroPad")(a.getSeconds(),2)+".000Z",l=n.toUTC(s,this.scope.schedulerTimeZone.name),c=l.getTime()):c=a.getTime(),this.requireFutureStartTime&&c>=o&&(this.scope.startDateError("Start time must be in the future"),i=!1))}catch(h){this.scope.startDateError("Invalid start time"),i=!1}else this.scope.startDateError("Provide a start time"),i=!1;return e.schedulerIsValid=i,i&&this.setDetails(),i},this.getRRule=function(){var e=this.getOptions();return l(e)},this.getValue=function(){var r=this.getRRule(),t=this.getOptions();return{name:e.schedulerName,rrule:r.toString(),options:t}},this.setRRule=function(e){return this.clear(),c(e,this.scope)},this.setName=function(e){this.scope.schedulerName=e},this.clear=function(){this.clearErrors(),this.scope.scheduler_form&&this.scope.scheduler_form.schedulerName&&this.scope.scheduler_form.schedulerName.$setPristine(),this.scope.setDefaults()},this.getUserTimezone=function(){return n.getLocal()},this.setRequireFutureStartTime=function(e){this.requireFutureStartTime=e},this.getRequireFutureStartTime=function(){return this.requireFutureStartTime},this.setShowRRule=function(r){e.showRRule=r}};return new s}function i(e){var l=e.scope,c=e.requireFutureStartTime||!1;return l.schedulerShowTimeZone=a,l.schedulerShowUTCStartTime=s,l.setDefaults=function(){a&&(l.current_timezone=n.getLocal(),($.isEmptyObject(l.current_timezone)||!l.current_timezone.name)&&(t.error("Failed to find local timezone. Defaulting to America/New_York."),l.current_timezone={name:"America/New_York"}),l.schedulerTimeZone=_.find(l.timeZones,function(e){return e.name===l.current_timezone.name})),l.scheduleTimeChange(),l.scheduleRepeatChange()},l.scheduleTimeChange=function(){if(""===l.schedulerStartDt||null===l.schedulerStartDt||void 0===l.schedulerStartDt)l.startDateError("Provide a valid start date and time"),l.schedulerUTCTime="";else if(u(l.schedulerStartHour,0,23,2)&&u(l.schedulerStartMinute,0,59,2)&&u(l.schedulerStartSecond,0,59,2))if(a){l.resetStartDate();try{var e=l.schedulerStartDt.replace(/(\d{2})\/(\d{2})\/(\d{4})/,function(e,r,t,n){return n+"-"+r+"-"+t});e+="T"+r("schZeroPad")(l.schedulerStartHour,2)+":"+r("schZeroPad")(l.schedulerStartMinute,2)+":"+r("schZeroPad")(l.schedulerStartSecond,2)+".000Z",l.schedulerUTCTime=r("schDateStrFix")(n.toUTC(e,l.schedulerTimeZone.name).toISOString()),l.scheduler_form_schedulerStartDt_error=!1,l.scheduler_startTime_error=!1}catch(t){l.startDateError("Provide a valid start date and time")}}else l.scheduler_startTime_error=!1,l.scheduler_form_schedulerStartDt_error=!1,l.schedulerUTCTime=r("schDateStrFix")(l.schedulerStartDt+"T"+l.schedulerStartHour+":"+l.schedulerStartMinute+":"+l.schedulerStartSecond+".000Z");else l.scheduler_startTime_error=!0},l.resetError=function(e){l[e]=!1},l.scheduleRepeatChange=function(){l.schedulerFrequency&&""!==l.schedulerFrequency.value&&"none"!==l.schedulerFrequency.value?(l.schedulerInterval=1,l.schedulerShowInterval=!0,l.schedulerIntervalLabel=l.schedulerFrequency.intervalLabel):(l.schedulerShowInterval=!1,l.schedulerEnd=l.endOptions[0]),l.sheduler_frequency_error=!1},l.showCalendar=function(e){$("#"+e).focus()},l.monthlyRepeatChange=function(){"day"!==l.monthlyRepeatOption?$("#monthDay").spinner("disable"):$("#monthDay").spinner("enable")},l.yearlyRepeatChange=function(){"month"!==l.yearlyRepeatOption?$("#yearlyRepeatDay").spinner("disable"):$("#yearlyRepeatDay").spinner("enable")},l.setWeekday=function(e,r){var t=l.weekDays.indexOf(r);t>=0?l.weekDays.splice(t,1):l.weekDays.push(r),$(e.target).blur(),l.scheduler_weekDays_error=!1},l.startDateError=function(e){l.scheduler_form&&(l.scheduler_form.schedulerStartDt&&(l.scheduler_form_schedulerStartDt_error=e,l.scheduler_form.schedulerStartDt.$pristine=!1,l.scheduler_form.schedulerStartDt.$dirty=!0),$("#schedulerStartDt").removeClass("ng-pristine").removeClass("ng-valid").removeClass("ng-valid-custom-error").addClass("ng-dirty").addClass("ng-invalid").addClass("ng-invalid-custom-error"))},l.resetStartDate=function(){l.scheduler_form&&(l.scheduler_form_schedulerStartDt_error="",l.scheduler_form.schedulerStartDt&&(l.scheduler_form.schedulerStartDt.$setValidity("custom-error",!0),l.scheduler_form.schedulerStartDt.$setPristine()))},l.schedulerEndChange=function(){var e=new Date,t=r("schZeroPad")(e.getMonth()+1,2),n=r("schZeroPad")(e.getDate(),2);l.schedulerEndDt=t+"/"+n+"/"+e.getFullYear(),l.schedulerOccurrenceCount=1},l.removeZonesReady&&l.removeZonesReady(),l.removeZonesReady=l.$on("zonesReady",function(){l.timeZones=JSON.parse(localStorage.zones),l.setDefaults()}),a?n.getZoneList(l):l.setDefaults(),o(l,c)}e.frequencyOptions=[{name:"None (run once)",value:"none",intervalLabel:""},{name:"Minute",value:"minutely",intervalLabel:"minutes"},{name:"Hour",value:"hourly",intervalLabel:"hours"},{name:"Day",value:"daily",intervalLabel:"days"},{name:"Week",value:"weekly",intervalLabel:"weeks"},{name:"Month",value:"monthly",intervalLabel:"months"},{name:"Year",value:"yearly",intervalLabel:"years"}],e.endOptions=[{name:"Never",value:"never"},{name:"After",value:"after"},{name:"On Date",value:"on"}],e.occurrences=[{name:"first",value:1},{name:"second",value:2},{name:"third",value:3},{name:"fourth",value:4},{name:"last",value:-1}],e.weekdays=[{name:"Sunday",value:"su"},{name:"Monday",value:"mo"},{name:"Tueday",value:"tu"},{name:"Wednesday",value:"we"},{name:"Thursday",value:"th"},{name:"Friday",value:"fr"},{name:"Saturday",value:"sa"},{name:"Day",value:["mo","tu","we","th","fr","sa","su"]},{name:"Weekday",value:["mo","tu","we","th","fr"]},{name:"Weekend day",value:["sa","su"]}],e.months=[{name:"January",value:1},{name:"February",value:2},{name:"March",value:3},{name:"April",value:4},{name:"May",value:5},{name:"June",value:6},{name:"July",value:7},{name:"August",value:8},{name:"September",value:9},{name:"October",value:10},{name:"November",value:11},{name:"December",value:12}],e.schedulerName="",e.weekDays=[],e.schedulerStartHour=0,e.schedulerStartMinute=0,e.schedulerStartSecond=0,e.schedulerStartDt=new Date,e.schedulerFrequency=e.frequencyOptions[0],e.schedulerShowEvery=!1,e.schedulerEnd=e.endOptions[0],e.schedulerInterval=1,e.schedulerOccurrenceCount=1,e.monthlyRepeatOption="day",e.monthDay=1,e.monthlyOccurrence=e.occurrences[0],e.monthlyWeekDay=e.weekdays[0],e.yearlyRepeatOption="month",e.yearlyMonth=e.months[0],e.yearlyMonthDay=1,e.yearlyWeekDay=e.weekdays[0],e.yearlyOtherMonth=e.months[0],e.yearlyOccurrence=e.occurrences[0],e.schedulerIsValid=!1,e.rrule_nlp_description="",e.rrule="",e.dateChoice="utc",e.occurrence_list=[],e.scheduler=i({scope:e,requireFutureStartTime:!1})}]),angular.module("angular-ui-scheduler").directive("angularUiScheduler",function(){return{restrict:"E",templateUrl:"angular-ui-scheduler/src/angularUiScheduler.html",controller:"angularUiSchedulerCtrl",link:function(e,r,t){}}});
//# sourceMappingURL=angular-ui-scheduler.min.js.map
