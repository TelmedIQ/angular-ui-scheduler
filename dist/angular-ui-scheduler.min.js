angular.module("angular-ui-scheduler",[]).constant("angular_ui_scheduler_hideStart",!0).constant("angular_ui_scheduler_useTimezone",!1),angular.module("angular-ui-scheduler").controller("angularUiSchedulerCtrl",["$scope","$filter","$log","rRuleHelper","angular_ui_scheduler_useTimezone","angular_ui_scheduler_frequencyOptions","angular_ui_scheduler_endOptions","angular_ui_scheduler_occurrences","angular_ui_scheduler_weekdays","angular_ui_scheduler_months",function(e,r,t,a,n,u,l,s,c,o){function i(){e.uiState={weekDays:[],schedulerStartDt:new Date,schedulerFrequency:e.frequencyOptions[0],schedulerEnd:e.endOptions[0],schedulerInterval:1,schedulerOccurrenceCount:1,monthlyRepeatOption:"day",monthDay:1,monthlyOccurrence:e.occurrences[0],monthlyWeekDay:e.weekdays[0],yearlyRepeatOption:"month",yearlyMonth:e.months[0],yearlyWeekDay:e.weekdays[0],yearlyOtherMonth:e.months[0],yearlyOccurrence:e.occurrences[0]},n&&(e.timeZones=moment.tz.names()),e.setDefaults()}e.schedulerShowTimeZone=n,e.frequencyOptions=u,e.endOptions=l,e.occurrences=s,e.weekdays=c,e.months=o,e.schedulerStartHour=function(r){return arguments.length?void(e.uiState.schedulerStartDt=moment(e.uiState.schedulerStartDt).hours(r).toDate()):e.uiState.schedulerStartDt.getHours()},e.schedulerStartMinute=function(r){return arguments.length?void(e.uiState.schedulerStartDt=moment(e.uiState.schedulerStartDt).minutes(r).toDate()):e.uiState.schedulerStartDt.getMinutes()},e.schedulerStartSecond=function(r){return arguments.length?void(e.uiState.schedulerStartDt=moment(e.uiState.schedulerStartDt).seconds(r).toDate()):e.uiState.schedulerStartDt.getSeconds()},e.setDefaults=function(){e.scheduleTimeChange(),e.scheduleRepeatChange()},e.scheduleTimeChange=function(){if(n){e.resetStartDate();try{e.scheduler_form_schedulerStartDt_error=!1,e.scheduler_startTime_error=!1}catch(r){e.startDateError("Provide a valid start date and time")}}else e.scheduler_startTime_error=!1,e.scheduler_form_schedulerStartDt_error=!1},e.scheduleRepeatChange=function(){e.uiState.schedulerFrequency&&""!==e.uiState.schedulerFrequency.value&&"none"!==e.uiState.schedulerFrequency.value?(e.uiState.schedulerInterval=1,e.schedulerShowInterval=!0,e.schedulerIntervalLabel=e.uiState.schedulerFrequency.intervalLabel):(e.schedulerShowInterval=!1,e.uiState.schedulerEnd=e.endOptions[0]),e.sheduler_frequency_error=!1},e.resetError=function(r){e[r]=!1},e.setWeekday=function(r,t){var a=e.uiState.weekDays.indexOf(t);a>=0?e.uiState.weekDays.splice(a,1):e.uiState.weekDays.push(t),$(r.target).blur(),e.scheduler_weekDays_error=!1},e.startDateError=function(r){e.scheduler_form_schedulerStartDt_error=r},e.resetStartDate=function(){e.scheduler_form_schedulerStartDt_error=""},e.schedulerEndChange=function(){e.uiState.schedulerOccurrenceCount=1},e.clearErrors=function(){e.scheduler_weekDays_error=!1,e.scheduler_endDt_error=!1,e.resetStartDate(),e.scheduler_endDt_error=!1,e.scheduler_interval_error=!1,e.scheduler_occurrenceCount_error=!1,e.scheduler_monthDay_error=!1},e.getRRule=function(){return a.getRule(e.uiState)},e.getValue=function(){var r=(e.getRRule(),a.getOptions(e.uiState));return{rrule:e.getRRule().toString(),options:r}},e.setRRule=function(r){e.clear(),a.setRule(r,e.uiState),e.scheduleRepeatChange()},e.setStartDate=function(r){e.uiState.schedulerStartDt=r},e.clear=function(){e.clearErrors(),e.setDefaults()},i(),e.$watch("uiState",function(r){e.rule=e.getValue()},!0)}]),angular.module("angular-ui-scheduler").constant("angular_ui_scheduler_frequencyOptions",[{name:"None (run once)",value:"none",intervalLabel:""},{name:"Minute",value:"minutely",intervalLabel:"minute(s)"},{name:"Hour",value:"hourly",intervalLabel:"hour(s)"},{name:"Day",value:"daily",intervalLabel:"day(s)"},{name:"Week",value:"weekly",intervalLabel:"week(s)"},{name:"Month",value:"monthly",intervalLabel:"month(s)"},{name:"Year",value:"yearly",intervalLabel:"year(s)"}]).constant("angular_ui_scheduler_endOptions",[{name:"Never",value:"never"},{name:"After",value:"after"},{name:"On Date",value:"on"}]).constant("angular_ui_scheduler_occurrences",[{name:"first",value:1},{name:"second",value:2},{name:"third",value:3},{name:"fourth",value:4},{name:"last",value:-1}]).constant("angular_ui_scheduler_weekdays",[{name:"Sunday",value:"su"},{name:"Monday",value:"mo"},{name:"Tuesday",value:"tu"},{name:"Wednesday",value:"we"},{name:"Thursday",value:"th"},{name:"Friday",value:"fr"},{name:"Saturday",value:"sa"},{name:"Day",value:["mo","tu","we","th","fr","sa","su"]},{name:"Weekday",value:["mo","tu","we","th","fr"]},{name:"Weekend day",value:["sa","su"]}]).constant("angular_ui_scheduler_months",[{name:"January",value:1},{name:"February",value:2},{name:"March",value:3},{name:"April",value:4},{name:"May",value:5},{name:"June",value:6},{name:"July",value:7},{name:"August",value:8},{name:"September",value:9},{name:"October",value:10},{name:"November",value:11},{name:"December",value:12}]).directive("angularUiScheduler",["$log",function(e){return{restrict:"E",require:"ngModel",templateUrl:"angular-ui-scheduler/src/angularUiScheduler.html",scope:{rrule:"@",hideStart:"=",startDate:"="},controller:"angularUiSchedulerCtrl",link:function(r,t,a,n){n.$formatters.push(function(r){return e.debug("angularUiSchedulerCtrl $formatters",r),angular.copy(r)}),n.$parsers.push(function(r){return e.debug("angularUiSchedulerCtrl $parsers",r),angular.copy(r)}),r.$watch("rule",function(r){e.debug("angularUiSchedulerCtrl updates ngModel binding",r),n.$setViewValue(angular.copy(r))},!0),a.required&&(n.$validators.required=function(e,r){return e}),r.$watch("rrule",function(t){t&&(e.debug("setting rrule",t),r.setRRule(t),r.setStartDate(r.startDate))}),r.$watch("startDate",function(t){t&&!r.rrule&&(e.debug("setting startDate",t),r.setStartDate(r.startDate))})}}}]),angular.module("angular-ui-scheduler").filter("schZeroPad",function(){return function(e,r){var t=(Math.pow(10,r)+"").replace(/^1/,"")+(e+"").trim();return t.substr(t.length-r)}}),angular.module("angular-ui-scheduler").factory("rRuleHelper",["angular_ui_scheduler_useTimezone","$log","$filter","angular_ui_scheduler_frequencyOptions","angular_ui_scheduler_occurrences","angular_ui_scheduler_endOptions","angular_ui_scheduler_weekdays","angular_ui_scheduler_months",function(e,r,t,a,n,u,l,s){return{getOptions:function(e){var r={};return r.startDate=e.schedulerStartDt,r.frequency=e.schedulerFrequency.value,r.interval=e.schedulerInterval,"after"===e.schedulerEnd.value&&(r.occurrenceCount=e.schedulerOccurrenceCount),"on"===e.schedulerEnd.value&&(r.endDate=moment(e.schedulerStartDt).add(1,"d").toDate()),"weekly"===e.schedulerFrequency.value?r.weekDays=e.weekDays:"yearly"===e.schedulerFrequency.value?"month"===e.yearlyRepeatOption?(r.month=e.yearlyMonth.value,r.monthDay=e.monthDay):(r.setOccurrence=e.yearlyOccurrence.value,r.weekDays=e.yearlyWeekDay.value,r.month=e.yearlyOtherMonth.value):"monthly"===e.schedulerFrequency.value&&("day"===e.monthlyRepeatOption?r.monthDay=e.monthDay:(r.setOccurrence=e.monthlyOccurrence.value,r.weekDays=e.monthlyWeekDay.value)),r},getRule:function(e){var t,a=this.getOptions(e),n=a.startDate,u=a.frequency,l=a.interval,s=a.occurrenceCount,c=a.endDate,o=a.month,i=a.monthDay,d=a.weekDays,h=a.setOccurrence,y={};if(angular.isDate(n))y.dtstart=n;else try{y.dtstart=new Date(n)}catch(m){r.error("Date conversion failed. Attempted to convert "+n+" to Date. "+m.message)}if(u&&"none"!==u){if(y.freq=RRule[u.toUpperCase()],y.interval=l,d&&"string"==typeof d&&(y.byweekday=RRule[d.toUpperCase()]),d&&angular.isArray(d))for(y.byweekday=[],t=0;t<d.length;t++)y.byweekday.push(RRule[d[t].toUpperCase()]);if(void 0!==h&&null!==h&&(y.bysetpos=h),o&&(y.bymonth=o),i&&(y.bymonthday=i),s)y.count=s;else if(c)if(angular.isDate(c))y.until=c;else try{y.until=new Date(c)}catch(m){r.error("Date conversion failed. Attempted to convert "+c+" to Date. "+m.message)}}else y.freq=RRule.DAILY,y.interval=1,y.count=1;return new RRule(y)},setRule:function(e,t){function c(e,r){var t=_.find(e,function(e){var t=e.split(/=/)[0].toUpperCase();return t===r});return t?t.split(/=/)[1].toUpperCase():null}function o(e){var r=e.toLowerCase().split(/,/),t=_.find(l,function(e){var t=angular.isArray(e.value)?e.value:[e.value],a=_.difference(t,r),n=_.difference(r,t);return 0===a.length&&0===n.length});return t}function i(e){return/\d{8}T\d{6}.*Z/.test(e)&&(e=e.replace(/(\d{4})(\d{2})(\d{2}T)(\d{2})(\d{2})(\d{2}.*$)/,function(e,r,t,a,n,u,l){return r+"-"+t+"-"+a+n+":"+u+":"+l.substr(0,2)+"Z"})),e}function d(e,l){var d=e[0].toUpperCase(),h=e[1];switch(d){case"FREQ":var y=h.toLowerCase();if(t.schedulerFrequency=_.find(a,function(e){return t.schedulerIntervalLabel=e.intervalLabel,e.value===y}),!t.schedulerFrequency||!t.schedulerFrequency.name)throw"FREQ not found in list of valid options";break;case"INTERVAL":if(!parseInt(h,10))throw"INTERVAL must contain an integer > 0";t.schedulerInterval=parseInt(h,10),t.schedulerShowInterval=!0;break;case"BYDAY":if("WEEKLY"===c(l,"FREQ")){var m=h.split(/,/);t.weekDays=[];for(var f=0;f<m.length;f++){if(!_.contains(["SU","MO","TU","WE","TH","FR","SA"],m[f]))throw"BYDAY contains unrecognized day value(s)";t.weekDays.push(m[f].toLowerCase()),t["weekDay"+m[f].toUpperCase()+"Class"]="active"}}else if("MONTHLY"===c(l,"FREQ")){if(t.monthlyRepeatOption="other",t.monthlyWeekDay=o(h),!t.monthlyWeekDay)throw"BYDAY contains unrecognized day value(s)"}else if(t.yearlyRepeatOption="other",t.yearlyWeekDay=o(h),!t.yearlyWeekDay)throw"BYDAY contains unrecognized day value(s)";break;case"BYMONTHDAY":if(!(parseInt(h,10)&&parseInt(h,10)>0&&parseInt(h,10)<32))throw"BYMONTHDAY must contain an integer between 1 and 31";t.monthDay=parseInt(h,10),t.monhthlyRepeatOption="day";break;case"DTSTART":h=i(h);var v=moment(h);if(!v.isValid())throw"Invalid DTSTART: "+h;t.schedulerStartDt=v.toDate();break;case"BYSETPOS":if("YEARLY"===c(l,"FREQ")){if(t.yearlRepeatOption="other",t.yearlyOccurrence=_.find(n,function(e){return e.value===parseInt(h,10)}),!t.yearlyOccurrence||!t.yearlyOccurrence.name)throw"BYSETPOS was not in the tokens of 1,2,3,4,-1"}else if(t.monthlyOccurrence=_.find(n,function(e){return e.value===parseInt(h,10)}),!t.monthlyOccurrence||!t.monthlyOccurrence.name)throw"BYSETPOS was not in the tokens of 1,2,3,4,-1";break;case"COUNT":if(!parseInt(h,10))throw"COUNT must be a valid integer > 0";t.schedulerEnd=u[1],t.schedulerOccurrenceCount=parseInt(h,10);break;case"UNTIL":h=i(h),t.schedulerEnd=u[2],t.schedulerEndDt=new Date(h);break;case"BYMONTH":if("YEARLY"===c(l,"FREQ")&&c(l,"BYDAY")){if(t.yearlRepeatOption="other",t.yearlyOtherMonth=_.find(s,function(e){return e.value===parseInt(h,10)}),!t.yearlyOtherMonth||!t.yearlyOtherMonth.name)throw"BYMONTH must be an integer between 1 and 12"}else if(t.yearlyOption="month",t.yearlyMonth=_.find(s,function(e){return e.value===parseInt(h,10)}),!t.yearlyMonth||!t.yearlyMonth.name)throw"BYMONTH must be an integer between 1 and 12";break;default:r.warn("rrule key `"+d+"` is invalid")}}function h(){if("weekly"===t.schedulerFrequency.name&&0===t.weekDays.length)throw"Frequency is weekly, but BYDAYS value is missing.";if(!t.schedulerStartDt)throw"Warning: start date was not provided"}if(!e)throw"No rule entered. Provide a valid RRule string.";var y=e.split(/;/);if(!angular.isArray(y))throw"No rule entered. Provide a valid RRule string.";return y.forEach(function(e){d(e.split(/=/),y)}),h(),t}}}]);
//# sourceMappingURL=angular-ui-scheduler.min.js.map
